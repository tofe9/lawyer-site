<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة التحكم | المحامي علي الحمداني</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Cairo',sans-serif;
  background:#0e0e0e;
  color:#fff
}
.wrap{
  max-width:1000px;
  margin:auto;
  padding:40px
}
h1,h3{color:#c9a24d}
label{display:block;margin-top:15px}
input,textarea{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:none;
  margin-top:5px;
  font-family:'Cairo'
}
textarea{resize:vertical}
button{
  margin-top:15px;
  background:#c9a24d;
  border:none;
  padding:12px 18px;
  font-weight:bold;
  cursor:pointer;
  border-radius:8px
}
.box{
  background:#1c1c1c;
  padding:25px;
  border-radius:16px;
  margin-bottom:30px
}
</style>
</head>

<body>

<div class="wrap">
<h1>لوحة التحكم</h1>

<!-- ===== مساعد الذكاء الاصطناعي ===== -->
<div class="box">
  <h3>مساعد المحتوى القانوني الذكي</h3>

  <label>موضوع المقال</label>
  <input id="aiTopic" placeholder="مثال: حقوق الزوجة في القانون العراقي">

  <button onclick="getArticle()">توليد مسودة مقال</button>

  <label>الناتج</label>
  <textarea id="aiResult" rows="8"></textarea>
</div>

<!-- ===== نشر المقال ===== -->
<div class="box">
  <h3>نشر مقال</h3>

  <label>عنوان المقال</label>
  <input id="articleTitle">

  <label>وصف مختصر (SEO)</label>
  <textarea id="articleDesc" rows="3"></textarea>

  <label>محتوى المقال</label>
  <textarea id="articleContent" rows="10"></textarea>

  <button onclick="publishArticle()">نشر المقال</button>
</div>
</div>

<script type="module">
/* ===== Firebase ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } 
  from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAW3c5b_n5qWP6M4cLqmHPF8D5b4DhWn4I",
  authDomain: "bill-2a791.firebaseapp.com",
  projectId: "bill-2a791"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ===== حماية الدخول ===== */
onAuthStateChanged(auth, user => {
  if (!user) {
    document.body.innerHTML = "غير مصرح لك بالدخول";
  }
});

/* ===== توليد مقال بالذكاء الاصطناعي ===== */
window.getArticle = async () => {
  try {
    const res = await fetch("/.netlify/functions/ai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        topic: document.getElementById("aiTopic").value
      })
    });

    const data = await res.json();

    if (data.error) {
      alert("خطأ من الخادم: " + data.error);
      return;
    }

    document.getElementById("aiResult").value =
      data.result || "لم يتم التوليد";

  } catch (e) {
    alert("خطأ في الاتصال: " + e.message);
  }
};

/* ===== نشر مقال ===== */
window.publishArticle = async () => {
  try {
    if (!articleTitle.value || !articleContent.value) {
      alert("العنوان والمحتوى مطلوبان");
      return;
    }

    await addDoc(collection(db, "articles"), {
      title: articleTitle.value,
      description: articleDesc.value,
      content: articleContent.value.replace(/\n/g, "<br>"),
      createdAt: serverTimestamp()
    });

    alert("✅ تم نشر المقال بنجاح");

    articleTitle.value = "";
    articleDesc.value = "";
    articleContent.value = "";

  } catch (e) {
    alert("خطأ في النشر: " + e.message);
  }
};
</script>

</body>
</html>